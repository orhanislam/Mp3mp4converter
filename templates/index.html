<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YouTube to MP3/MP4 Converter</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif; padding: 2rem; max-width: 720px; margin: 0 auto; color: #111; }
    h1 { font-size: 1.6rem; margin-bottom: 1rem; }
    form { display: grid; gap: 0.75rem; }
    .row { display: flex; gap: 0.5rem; }
    input[type="text"] { flex: 1; padding: 0.6rem 0.75rem; border: 1px solid #ccc; border-radius: 8px; font-size: 1rem; }
    .options { display: flex; align-items: center; gap: 1rem; }
    button { background: #111; color: #fff; padding: 0.6rem 1rem; border-radius: 8px; border: none; cursor: pointer; font-size: 1rem; }
    button[disabled] { opacity: 0.6; cursor: not-allowed; }
    .status { min-height: 1.25rem; color: #444; font-size: 0.95rem; }
    .hint { color: #666; font-size: 0.9rem; }
    .card { border: 1px solid #e6e6e6; border-radius: 12px; padding: 1rem; background: #fafafa; }
  </style>
</head>
<body>
  <h1>YouTube to MP3/MP4 Converter</h1>

  <div class="card">
    <form id="convert-form">
      <label for="url">YouTube link</label>
      <div class="row">
        <input id="url" name="url" type="text" placeholder="https://www.youtube.com/watch?v=..." required />
      </div>

      <div class="options">
        <label><input type="radio" name="format" value="mp3" checked /> MP3 (highest quality)</label>
        <label><input type="radio" name="format" value="mp4" /> MP4 (highest quality)</label>
      </div>

      <div class="row">
        <button id="download-btn" type="submit">Convert & Download</button>
      </div>

      <div class="status" id="status"></div>
      <div class="hint">By using this tool, ensure you respect the content owner's rights and platform terms.</div>
    </form>
  </div>

  <script>
    const form = document.getElementById('convert-form');
    const statusEl = document.getElementById('status');
    const button = document.getElementById('download-btn');

    function setBusy(isBusy, message = '') {
      button.disabled = isBusy;
      statusEl.textContent = message;
      button.textContent = isBusy ? 'Processing…' : 'Convert & Download';
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const url = document.getElementById('url').value.trim();
      const format = new FormData(form).get('format');

      if (!url) {
        statusEl.textContent = 'Please paste a YouTube link.';
        return;
      }

      setBusy(true, 'Fetching and converting to ' + format.toUpperCase() + '…');

      try {
        const response = await fetch('/api/download', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ url, format })
        });
        if (!response.ok) {
          const err = await response.json().catch(() => ({}));
          throw new Error(err.error || ('Request failed with status ' + response.status));
        }

        const blob = await response.blob();
        let filename = 'download.' + (format === 'mp3' ? 'mp3' : 'mp4');
        const disposition = response.headers.get('Content-Disposition');
        if (disposition) {
          const match = /filename="?([^";]+)"?/i.exec(disposition);
          if (match) filename = match[1];
        }

        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        link.remove();
        URL.revokeObjectURL(link.href);
        setBusy(false, 'Done. Your download should start shortly.');
      } catch (err) {
        console.error(err);
        setBusy(false, err.message || 'Something went wrong.');
      }
    });
  </script>
</body>
</html>